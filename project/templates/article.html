{% extends 'base.html' %}
{% load static %}
{% block title %}
article name
{% endblock %}

{% block content %}
<!-- Blog Post -->
    <h1 class="my-4">{{ article.title }}
    </h1>
    <div class="card mb-4">
        <img class="card-img-top" src="{% static article.image.url %}" alt="Card image cap">
        <div class="card-body">
            <p class="card-text">{{ article.text }}</p>
            <p>Понравилось: <span id="lc">{{ article.total_likes}}</span></p>
            {% if user.is_authenticated %}
                <input type="button" class="btn btn-primary" id="like" name="{{ article.id }}" value="Like" />
            {% endif %}
        </div>
        <div class="card-footer text-muted">
            Posted on {{ article.created_date }} by {{ article.author }}
        </div>
        <div>
            {% for comment in comments %}
                <p>{{ comment.author.get_full_name }}: {{ comment.text }}</p>
                <p>{{ comment.created_date }}</p>
            {% endfor %}
        </div>
        {% if user.is_authenticated %}
            <div>
                <form action="" method="POST">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-primary">Отправить</button>
                </form>
            </div>
        {% else %}
            <h6>
                <p>Только авторизованные пользователи могут оставлять комментарии</p>
            </h6>
        {% endif %}
    </div>



<!-- Pagination -->
    <ul class="pagination justify-content-center mb-4">
        <li class="page-item">
            <a class="page-link" href="#">&larr; Older</a>
        </li>
        <li class="page-item disabled">
            <a class="page-link" href="#">Newer &rarr;</a>
        </li>
    </ul>


{% endblock %}

{% block javascript %}
<script>

    $('#like').click(function(){
        $.ajax({
                    type: "POST",
                    url: "{% url 'like' %}",
                    data: {'id': $(this).attr('name'), 'csrfmiddlewaretoken': '{{ csrf_token }}'},
                    dataType: "json",
                    success: function(response) {
                            $('#lc').text(response.likes_count);                            
                    },
                    error: function(rs, e) {
                            alert(rs.responseText);
                    }
                }); 
    })
</script>
{% endblock %}